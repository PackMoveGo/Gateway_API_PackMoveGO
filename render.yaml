services:
  # Private API service - not accessible from public internet
  - type: private
    name: pack-go-movers-api-private
    env: node
    repo: https://github.com/SereneAura2/PackMoveGO-API
    buildCommand: npm install && npm run build
    startCommand: node dist/src/server.js
    # Load balancing configuration for private service
    scaling:
      minInstances: 2
      maxInstances: 5
      targetConcurrency: 10
      targetCpuUtilizationPercent: 70
    # Private service configuration
    port: 3000
    internalOnly: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: SERVICE_TYPE
        value: private
      # PORT is automatically assigned by Render - no need to set it explicitly
      - key: MONGODB_URI
        value: "SET_IN_RENDER_DASHBOARD"
      - key: DATABASE_URL
        value: "SET_IN_RENDER_DASHBOARD"
      - key: CORS_ORIGIN
        value: https://www.packmovego.com,https://packmovego.com
      - key: CORS_METHODS
        value: GET,POST,PUT,DELETE,OPTIONS
      - key: CORS_ALLOWED_HEADERS
        value: Content-Type,Authorization,x-api-key
      - key: JWT_SECRET
        value: "SET_IN_RENDER_DASHBOARD"
      - key: JWT_ACCESS_SECRET
        value: "SET_IN_RENDER_DASHBOARD"
      - key: JWT_REFRESH_SECRET
        value: "SET_IN_RENDER_DASHBOARD"
      - key: STRIPE_SECRET_KEY
        value: "SET_IN_RENDER_DASHBOARD"
      - key: STRIPE_PUBLISHABLE_KEY
        value: "SET_IN_RENDER_DASHBOARD"
      - key: EMAIL_USER
        value: "SET_IN_RENDER_DASHBOARD"
      - key: EMAIL_PASSWORD
        value: "SET_IN_RENDER_DASHBOARD"
      - key: EMAIL_HOST
        value: "SET_IN_RENDER_DASHBOARD"
      - key: EMAIL_PORT
        value: "587"
      - key: EMAIL_SECURE
        value: "true"
      - key: PRODUCTION_DOMAIN
        value: https://www.packmovego.com
      - key: API_URL
        value: https://api.packmovego.com
      - key: DEBUG
        value: false
      - key: LOG_LEVEL
        value: info
      - key: RATE_LIMIT_WINDOW_MS
        value: 900000
      - key: RATE_LIMIT_MAX_REQUESTS
        value: 50
      - key: MAINTENANCE_MODE
        value: false
      # Security Configuration
      - key: API_KEY_ENABLED
        value: true
      - key: API_KEY_FRONTEND
        value: "SET_IN_RENDER_DASHBOARD"
      - key: API_KEY_ADMIN
        value: "SET_IN_RENDER_DASHBOARD"
      - key: ADMIN_PASSWORD
        value: "SET_IN_RENDER_DASHBOARD"
      - key: SSH_PASSWORD
        value: "SET_IN_RENDER_DASHBOARD"
      - key: WEBHOOK_SECRET
        value: "SET_IN_RENDER_DASHBOARD"
      # Private Network Configuration
      - key: PRIVATE_LINK_ENABLED
        value: true
      - key: ENABLE_SERVICE_DISCOVERY
        value: true
      - key: MAX_OPEN_PORTS
        value: 75
      - key: PRIVATE_NETWORK_TIMEOUT
        value: 30000
      # Load Balancing Configuration
      - key: ENABLE_LOAD_BALANCING
        value: true
      - key: INSTANCE_ID
        value: "SET_BY_RENDER"
      - key: HEALTH_CHECK_INTERVAL
        value: 30000
      - key: SESSION_STICKINESS
        value: false
    healthCheckPath: /api/health
    autoDeploy: true
    plan: starter  # Upgrade from free to starter for load balancing

  # Public gateway service - accessible from internet
  - type: web
    name: pack-go-movers-gateway
    env: node
    repo: https://github.com/SereneAura2/PackMoveGO-API
    buildCommand: npm install && npm run build
    startCommand: node dist/src/gateway.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: SERVICE_TYPE
        value: gateway
      - key: PRIVATE_API_URL
        value: "http://pack-go-movers-api-private:3000"
      - key: CORS_ORIGIN
        value: https://www.packmovego.com,https://packmovego.com
      - key: JWT_SECRET
        value: "SET_IN_RENDER_DASHBOARD"
      - key: API_KEY_ENABLED
        value: true
      - key: API_KEY_FRONTEND
        value: "SET_IN_RENDER_DASHBOARD"
    healthCheckPath: /health
    autoDeploy: true
    plan: starter 